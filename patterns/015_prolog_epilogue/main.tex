\chapter{\RU{Пролог и эпилог функций}\EN{Function prologue and epilogue}}
\label{sec:prologepilog}
\index{Function epilogue}
\index{Function prologue}

\RU{Пролог функции это инструкции в самом начале функции. Как правило это что-то вроде такого
фрагмента кода:}
\EN{A function prologue is a sequence of instructions at the start of a function. It often looks something like the following
code fragment:}

\begin{lstlisting}
    push    ebp
    mov     ebp, esp
    sub     esp, X
\end{lstlisting}

\RU{Эти инструкции делают следующее: сохраняют значение регистра \EBP на будущее, выставляют \EBP равным \ESP, 
затем подготавливают место в стеке для хранения локальных переменных.}
\EN{What these instruction do: save the value in the \EBP register,
set the value of the \EBP register to the value of the \ESP and then allocate space on the stack 
for local variables.}

\RU{\EBP сохраняет свое значение на протяжении всей функции, он будет использоваться здесь для доступа 
к локальным переменным и аргументам. Можно было бы использовать и \ESP, но он постоянно меняется и 
это не очень удобно.}
\EN{The value in the \EBP stays the same over the period of the function execution and is to be used for local variables and 
arguments access. 
For the same purpose one can use \ESP, but since it changes over time this approach is not too convenient.}

\RU{Эпилог функции аннулирует выделенное место в стеке, восстанавливает значение \EBP на старое и возвращает 
управление в вызывающую функцию:}
\EN{The function epilogue frees the allocated space in the stack, returns the value in the \EBP register back to its initial state 
and returns the control flow to the \gls{callee}:}

\begin{lstlisting}
    mov    esp, ebp
    pop    ebp
    ret    0
\end{lstlisting}

% what about calling convention?
\RU{Пролог и эпилог функции обычно находятся в дизассемблерах для отделения функций друг от друга.}
\EN{Function prologues and epilogues are usually detected in disassemblers for function delimitation.}

\section{\Recursion}

\index{\Recursion}
\RU{Наличие эпилога и пролога может несколько ухудшить эффективность рекурсии.}
\EN{Epilogues and prologues can negatively affect the recursion performance.}

\EN{More about recursion in this book}\RU{Больше о рекурсии в этой книге}: 
\myref{Recursion_and_tail_call}.
